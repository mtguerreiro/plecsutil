<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User guide &mdash; plecsutil v0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=4c0d86c8"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="plecsutil package" href="plecsutil.html" />
    <link rel="prev" title="Quickstart guide" href="quickstart_guide.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            plecsutil
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart_guide.html">Quickstart guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-plecs-model">Creating the PLECS model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-python-script">Creating the Python script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation-results">Simulation results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-simulations-with-different-model-parameters">Running simulations with different model parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-model-py-file">The <code class="docutils literal notranslate"><span class="pre">model.py</span></code> file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-controllers">Working with controllers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#single-controller">Single controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-controllers">Multiple controllers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#saving-and-loading-simulation-results">Saving and loading simulation results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plecsutil.html">plecsutil package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">plecsutil</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">User guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/user_guide.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="user-guide">
<h1>User guide<a class="headerlink" href="#user-guide" title="Permalink to this heading"></a></h1>
<p>This page shows how to build PLECS models and Python scripts so that simulations can be automated with <code class="docutils literal notranslate"><span class="pre">plecsutil</span></code>.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sec-user-guide-intro"><span class="std std-ref">Introduction</span></a>: basics to create PLECS models, the <code class="docutils literal notranslate"><span class="pre">model.py</span></code> files, and running the simulation with <code class="docutils literal notranslate"><span class="pre">plecsutil</span></code></p></li>
<li><p><a class="reference internal" href="#sec-user-guide-working-controllers"><span class="std std-ref">Working with controllers</span></a>: basics to create PLECS models with single or multiple controllers</p></li>
<li><p><a class="reference internal" href="#sec-user-guide-save-load"><span class="std std-ref">Saving and loading simulation results</span></a>: Saving and loading simulation results</p></li>
</ul>
<section id="introduction">
<span id="sec-user-guide-intro"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<section id="creating-the-plecs-model">
<h3>Creating the PLECS model<a class="headerlink" href="#creating-the-plecs-model" title="Permalink to this heading"></a></h3>
<p>To work with <code class="docutils literal notranslate"><span class="pre">plecsutil</span></code>, the PLECS model needs at least two elements: an output data port in the top-level circuit, and a link to the <code class="docutils literal notranslate"><span class="pre">.m</span></code> file containing the model parameters.</p>
<p>The output data port (or ports) in the top-level circuit defines which signals are sent to Python at the end of each simulation. A data port can contain a single signal, or many signals can be multiplexed and connected to a single data port. <a class="reference internal" href="#fig-user-guide-schematic"><span class="std std-numref">Fig. 1</span></a> shows an example of a Buck converter with output data ports in the top-level circuit. (You can download the example by clicking <a class="reference download internal" download="" href="_downloads/486b66b8998534eb86a494929fde2a5d/buck_intro.plecs"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.)</p>
<figure class="align-center" id="fig-user-guide-schematic">
<a class="reference internal image-reference" href="_images/schematic.svg"><img alt="Output data port in top-level." height="376" src="_images/schematic.svg" width="504" /></a>
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">PLECS model with output data port in the top-level circuit.</span><a class="headerlink" href="#fig-user-guide-schematic" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The link to the <code class="docutils literal notranslate"><span class="pre">.m</span></code> file is given in the initialization tab of the simulation parameters, as shown in <a class="reference internal" href="#fig-user-guide-initialization"><span class="std std-numref">Fig. 2</span></a>. It is important that the name of the <code class="docutils literal notranslate"><span class="pre">.m</span></code> matches the name of the PLECS  model (the simulation file). Thus, if the name of the PLECS model is <code class="docutils literal notranslate"><span class="pre">buck_intro.plecs</span></code>, the name of the initialization file must be indicated in the simulation parameters must be <code class="docutils literal notranslate"><span class="pre">buck_intro.m</span></code>.</p>
<figure class="align-center" id="fig-user-guide-initialization">
<a class="reference internal image-reference" href="_images/initialization.png"><img alt="Initialization of simulation parameters ." src="_images/initialization.png" style="width: 210.0px; height: 314.5px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2 </span><span class="caption-text">Initialization of the simulation parameters.</span><a class="headerlink" href="#fig-user-guide-initialization" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="creating-the-python-script">
<h3>Creating the Python script<a class="headerlink" href="#creating-the-python-script" title="Permalink to this heading"></a></h3>
<p>Running the PLECS simulation requires creating a <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel" title="plecsutil.ui.PlecsModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel</span></code></a> object informing the name of the PLECS model, its path, and a Python dictionary containing all of the parameters of the model.</p>
<p>An example of a Python script is shown below. Note that the script assumes to be in the same folder as that the PLECS model, since it defines the <code class="docutils literal notranslate"><span class="pre">plecs_file_path</span></code> as the current working directory.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-number">Listing 1 </span><span class="caption-text">Running a PLECS simulation with <code class="docutils literal notranslate"><span class="pre">plecsutil</span></code> (<a class="reference download internal" download="" href="_downloads/051590665a5a8077addc9bb83cc503d0/buck_intro.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">source</span></code></a>)</span><a class="headerlink" href="#id1" title="Permalink to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plecsutil</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pu</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

<span class="c1"># Model params</span>
<span class="n">model_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;f_pwm&#39;</span><span class="p">:</span> <span class="mf">100e3</span><span class="p">,</span>
    <span class="s1">&#39;V_in&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
    <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="mf">47e-6</span><span class="p">,</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">220e-6</span>
    <span class="p">}</span>

<span class="c1"># Plecs file</span>
<span class="n">plecs_file</span> <span class="o">=</span> <span class="s1">&#39;buck_intro&#39;</span>
<span class="n">plecs_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

<span class="c1"># Plecs model</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">PlecsModel</span><span class="p">(</span><span class="n">plecs_file</span><span class="p">,</span> <span class="n">plecs_file_path</span><span class="p">,</span> <span class="n">model_params</span><span class="p">)</span>

<span class="c1"># Runs simulation</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sim</span><span class="p">()</span>

<span class="c1"># Plots results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>In this example, when calling <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel.sim" title="plecsutil.ui.PlecsModel.sim"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel.sim()</span></code></a> to run the simulation, <code class="docutils literal notranslate"><span class="pre">plecsutil</span></code> will generate a <code class="docutils literal notranslate"><span class="pre">.m</span></code> file. This files contains the model parameters given by the <code class="docutils literal notranslate"><span class="pre">model_params</span></code> dictionary is used to initialize the <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel" title="plecsutil.ui.PlecsModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel</span></code></a> object. After generating the <code class="docutils literal notranslate"><span class="pre">.m</span></code> file, the simulation is launched, which then uses the <code class="docutils literal notranslate"><span class="pre">.m</span></code> as source.</p>
</section>
<section id="simulation-results">
<h3>Simulation results<a class="headerlink" href="#simulation-results" title="Permalink to this heading"></a></h3>
<p>After running a simulation, <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel.sim" title="plecsutil.ui.PlecsModel.sim"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel.sim()</span></code></a> returns a <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.DataSet" title="plecsutil.ui.DataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">plecsutil.ui.DataSet</span></code></a> dataclass holding the simulation results. In addition to the data points, <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.DataSet" title="plecsutil.ui.DataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">plecsutil.ui.DataSet</span></code></a> contains a <code class="docutils literal notranslate"><span class="pre">meta</span></code> field. This field has  a dictionary with a <code class="docutils literal notranslate"><span class="pre">model_params</span></code> entry that  stores the  model parameters used to produce the associated simulation results. Thus, the simulation results are always saved with the parameters used to produce them.</p>
</section>
<section id="running-simulations-with-different-model-parameters">
<h3>Running simulations with different model parameters<a class="headerlink" href="#running-simulations-with-different-model-parameters" title="Permalink to this heading"></a></h3>
<p>The <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel.sim" title="plecsutil.ui.PlecsModel.sim"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel.sim()</span></code></a> accepts a <code class="docutils literal notranslate"><span class="pre">sim_params</span></code> dictionary that can be used to overwrite the default model parameters defined when initializing the <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel" title="plecsutil.ui.PlecsModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel</span></code></a> object. The <code class="docutils literal notranslate"><span class="pre">sim_params</span></code> dictionary doesn’t need to contain all model parameters, but just the parameters to be overwritten. In the example Python script shown above, calling <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel.sim" title="plecsutil.ui.PlecsModel.sim"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel.sim()</span></code></a> as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sim</span><span class="p">({</span><span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">})</span>
</pre></div>
</div>
<p>will run the simulation with <code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">=</span> <span class="pre">4</span></code>, instead of the default value of 10 defined by <code class="docutils literal notranslate"><span class="pre">model_params</span></code>.</p>
<p>An example of running the simulation of the Buck converter with different <code class="docutils literal notranslate"><span class="pre">R</span></code> values is shown below. In this example, <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel.sim" title="plecsutil.ui.PlecsModel.sim"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel.sim()</span></code></a> is called with <code class="docutils literal notranslate"><span class="pre">sim_params</span></code> specifying different values for <code class="docutils literal notranslate"><span class="pre">R</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-number">Listing 2 </span><span class="caption-text">Running the PLECS model with different model parameters (<a class="reference download internal" download="" href="_downloads/e699d3e40df3829849329ade43d001bd/buck_intro_var_r.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">source</span></code></a>)</span><a class="headerlink" href="#id2" title="Permalink to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plecsutil</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pu</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

<span class="c1"># Model params</span>
<span class="n">model_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;f_pwm&#39;</span><span class="p">:</span> <span class="mf">100e3</span><span class="p">,</span>
    <span class="s1">&#39;V_in&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
    <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="mf">47e-6</span><span class="p">,</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">220e-6</span>
    <span class="p">}</span>

<span class="c1"># Plecs file</span>
<span class="n">plecs_file</span> <span class="o">=</span> <span class="s1">&#39;buck_intro&#39;</span>
<span class="n">plecs_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

<span class="c1"># Plecs model</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">PlecsModel</span><span class="p">(</span><span class="n">plecs_file</span><span class="p">,</span> <span class="n">plecs_file_path</span><span class="p">,</span> <span class="n">model_params</span><span class="p">)</span>

<span class="c1"># Runs simulation</span>
<span class="n">R_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">R_vals</span><span class="p">:</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="n">sim_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="n">r</span><span class="p">})</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

<span class="c1"># Plots results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;R = </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;model_params&#39;</span><span class="p">][</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="the-model-py-file">
<h3>The <code class="docutils literal notranslate"><span class="pre">model.py</span></code> file<a class="headerlink" href="#the-model-py-file" title="Permalink to this heading"></a></h3>
<p>In the previous examples, the dictionary containing the model parameters (<code class="docutils literal notranslate"><span class="pre">model_params</span></code>) was defined in the script that runs the simulation. This makes managing the model parameters more difficult when there are multiple Python scripts to perform different simulations of the same model. In the Buck model used as example, one might create one script to run the model with different values for <code class="docutils literal notranslate"><span class="pre">R</span></code>, and another one for different values of <code class="docutils literal notranslate"><span class="pre">f_pwm</span></code>. If the parameters of the PLECS model need to be updated, all scripts need to be modified to include the new parameters.</p>
<p>This can be avoided by creating a <code class="docutils literal notranslate"><span class="pre">model.py</span></code> associated with the PLECS model. In this way, the model parameters are defined in a single location, and all scripts  running simulations can simply import the model from the <code class="docutils literal notranslate"><span class="pre">model.py</span></code> file.</p>
<p>Although the <code class="docutils literal notranslate"><span class="pre">model.py</span></code> can be created and define the dictionary with the model parameters, it is more flexible to create a function that returns the parameters instead. The advantages of this approach become clear when adding controllers to the simulation.</p>
<p>For the Buck example discussed thus far, we can create an associated <code class="docutils literal notranslate"><span class="pre">model.py</span></code> with the following contents:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-number">Listing 3 </span><span class="caption-text">Example of <code class="docutils literal notranslate"><span class="pre">model.py</span></code> file (<a class="reference download internal" download="" href="_downloads/ef32c79c1ac67e49e1ccfaa472a08482/model.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">source</span></code></a>)</span><a class="headerlink" href="#id3" title="Permalink to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">params</span><span class="p">():</span>

    <span class="n">model_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;f_pwm&#39;</span><span class="p">:</span> <span class="mf">100e3</span><span class="p">,</span>
        <span class="s1">&#39;V_in&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
        <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="mf">47e-6</span><span class="p">,</span>
        <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">220e-6</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="n">model_params</span>
</pre></div>
</div>
</div>
<p>Now, <code class="docutils literal notranslate"><span class="pre">model.py</span></code> can be imported by Python scripts to get the model parameters. For example, to run the Buck converter model with varying values for <code class="docutils literal notranslate"><span class="pre">R</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-number">Listing 4 </span><span class="caption-text">Using <code class="docutils literal notranslate"><span class="pre">model.py</span></code> to run simulations (<a class="reference download internal" download="" href="_downloads/566b2060af4ba5e40b982a9d3406b00e/buck_intro_model.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">source</span></code></a>)</span><a class="headerlink" href="#id4" title="Permalink to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plecsutil</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pu</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">model</span>

<span class="c1"># Plecs file</span>
<span class="n">plecs_file</span> <span class="o">=</span> <span class="s1">&#39;buck_intro&#39;</span>
<span class="n">plecs_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

<span class="c1"># Plecs model</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">PlecsModel</span><span class="p">(</span><span class="n">plecs_file</span><span class="p">,</span> <span class="n">plecs_file_path</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">())</span>

<span class="c1"># Runs simulation</span>
<span class="n">R_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">R_vals</span><span class="p">:</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="n">sim_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="n">r</span><span class="p">})</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

<span class="c1"># Plots results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;R = </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;model_params&#39;</span><span class="p">][</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="working-with-controllers">
<span id="sec-user-guide-working-controllers"></span><h2>Working with controllers<a class="headerlink" href="#working-with-controllers" title="Permalink to this heading"></a></h2>
<p>It is often interesting to see how a closed-loop system behaves, especially when changing controller parameters. There are also case where we have more than one controller and would like to compare them. <code class="docutils literal notranslate"><span class="pre">plecsutil</span></code> provides a way to define controllers as part of the model, and vary their parameters.</p>
<section id="single-controller">
<h3>Single controller<a class="headerlink" href="#single-controller" title="Permalink to this heading"></a></h3>
<p>When the model has a single controller, changing the parameters of the controller can be done much in the same way as changing the parameters of the model. After all, the controller is part of the model. However, it is often the case that we don’t want to specify the controller gains directly, but rather through some other specifications. For example, we may have a design method, where we specify the settling time of the controller to get the gains. Then, it is a question of concatenating the parameters of the plant with the parameters of the controller, in order to create a single dictionary with all parameters of the model.</p>
<p>Consider state-feedback controller for a Buck converter shown in <a class="reference internal" href="#fig-user-guide-controllers-sfb-buck"><span class="std std-numref">Fig. 3</span></a>. This controller has two parameters, which are part of the model parameters: the vector <code class="docutils literal notranslate"><span class="pre">Kx</span></code> and the gain <code class="docutils literal notranslate"><span class="pre">Ke</span></code>.</p>
<figure class="align-center" id="fig-user-guide-controllers-sfb-buck">
<a class="reference internal image-reference" href="_images/sfb_controller.svg"><img alt="State-feedback controller for a buck converter." height="418" src="_images/sfb_controller.svg" width="392" /></a>
<figcaption>
<p><span class="caption-number">Fig. 3 </span><span class="caption-text">State-feedback controller for a Buck converter.</span><a class="headerlink" href="#fig-user-guide-controllers-sfb-buck" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>These two gains can be determined based on time response specifications of the closed-loop system, such as settling time and overshoot. This is possible with pole placement, based on a model of the converter.</p>
<p>Now, we can identify two sets of parameters: the plant parameters, and the controller parameters. These two combined compose the model parameters. In our <code class="docutils literal notranslate"><span class="pre">model.py</span></code> file, we can then create three functions: one for the parameters of the plant, one for the parameters of the controller, and one that concatenates them. An example of such structure is shown in the script below.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-number">Listing 5 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">model.py</span></code> with plant, controller and model parameters (<a class="reference download internal" download="" href="_downloads/40e950f1735fadbcdd72f7fad1d6a935/model.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">source</span></code></a>)</span><a class="headerlink" href="#id5" title="Permalink to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.signal</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plant_params</span><span class="p">():</span>

    <span class="n">V_in</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">Vo_ref</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="n">L</span> <span class="o">=</span> <span class="mf">47e-6</span>
    <span class="n">C_out</span> <span class="o">=</span> <span class="mf">220e-6</span>

    <span class="n">f_pwm</span> <span class="o">=</span> <span class="mf">100e3</span>

    <span class="n">R</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">Rd</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;C_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">C_out</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Rd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rd</span>

    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;V_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_in</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Vo_ref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Vo_ref</span>
    
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;f_pwm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">100e3</span>

    <span class="k">return</span> <span class="n">params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">controller_gains</span><span class="p">(</span><span class="n">ctl_params</span><span class="p">):</span>
    
    <span class="n">ts</span> <span class="o">=</span> <span class="n">ctl_params</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span>
    <span class="n">os</span> <span class="o">=</span> <span class="n">ctl_params</span><span class="p">[</span><span class="s1">&#39;os&#39;</span><span class="p">]</span>

    <span class="n">_plant_params</span> <span class="o">=</span> <span class="n">plant_params</span><span class="p">()</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">_plant_params</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">_plant_params</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">_plant_params</span><span class="p">[</span><span class="s1">&#39;C_out&#39;</span><span class="p">]</span>
    <span class="n">V_in</span> <span class="o">=</span> <span class="n">_plant_params</span><span class="p">[</span><span class="s1">&#39;V_in&#39;</span><span class="p">]</span>
    
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span>       <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">L</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="n">C</span><span class="p">,</span>   <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">R</span> <span class="o">/</span> <span class="n">C</span><span class="p">]</span>
        <span class="p">])</span>
    
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="n">V_in</span> <span class="o">/</span> <span class="n">L</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">])</span>

    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    
    <span class="n">Aa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">Aa</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span>
    <span class="n">Aa</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">C</span>

    <span class="n">Ba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">Ba</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">zeta</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">os</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">os</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    <span class="n">wn</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">ts</span> <span class="o">/</span> <span class="n">zeta</span>

    <span class="n">p1</span> <span class="o">=</span> <span class="o">-</span> <span class="n">zeta</span> <span class="o">*</span> <span class="n">wn</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">wn</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zeta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
    <span class="n">p3</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">p1</span><span class="o">.</span><span class="n">real</span>
    
    <span class="n">K</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">place_poles</span><span class="p">(</span><span class="n">Aa</span><span class="p">,</span> <span class="n">Ba</span><span class="p">,</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">))</span><span class="o">.</span><span class="n">gain_matrix</span>

    <span class="n">Kx</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">Ke</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Kx&#39;</span><span class="p">:</span> <span class="n">Kx</span><span class="p">,</span> <span class="s1">&#39;Ke&#39;</span><span class="p">:</span> <span class="n">Ke</span><span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">params</span><span class="p">():</span>

    <span class="c1"># Plant parameters</span>
    <span class="n">_plant_params</span> <span class="o">=</span> <span class="n">plant_params</span><span class="p">()</span>

    <span class="c1"># Control parameters</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="mf">2e-3</span>
    <span class="n">os</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">_ctl_params</span> <span class="o">=</span> <span class="n">controller_gains</span><span class="p">({</span><span class="s1">&#39;ts&#39;</span><span class="p">:</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">:</span><span class="n">os</span><span class="p">})</span>

    <span class="c1"># Model params</span>
    <span class="n">_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">_plant_params</span> <span class="p">)</span>
    <span class="n">_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">_ctl_params</span> <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">_params</span>
</pre></div>
</div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">controller_gains</span></code> gain function takes as argument a dictionary, which contains the parameters of the controller. In this case, the parameters are <code class="docutils literal notranslate"><span class="pre">ts</span></code> (settling time) and <code class="docutils literal notranslate"><span class="pre">os</span></code> (overshoot). The function also returns a dictionary, containing the gains that are used in the model.</p>
<p>When there is a  controller, <code class="docutils literal notranslate"><span class="pre">plecsutil</span></code> is made aware of it by informing the function that returns the controller gains when creating the <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel" title="plecsutil.ui.PlecsModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel</span></code></a> object. When running the simulation, the user can set the parameters of the controller and pass them to <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel.sim" title="plecsutil.ui.PlecsModel.sim"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel.sim()</span></code></a>. Internally,  <code class="docutils literal notranslate"><span class="pre">plecsutil</span></code> calls the function to get the gains, and updates the parameters of the model automatically. This is demonstrated in the script below.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-number">Listing 6 </span><span class="caption-text">Running a simulation with a single controller (<a class="reference download internal" download="" href="_downloads/14421dbbc1d9a41f598b9b5ae68a1b21/buck_single_controller.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">source</span></code></a> and <a class="reference download internal" download="" href="_downloads/f0ab53613b54340ba502a9b8cd96514e/buck_single_controller.plecs"><code class="xref download docutils literal notranslate"><span class="pre">PLECS</span> <span class="pre">model</span></code></a>)</span><a class="headerlink" href="#id6" title="Permalink to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">plecsutil</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pu</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">model</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

<span class="c1"># --- Input ---</span>
<span class="n">plecs_file</span> <span class="o">=</span> <span class="s1">&#39;buck_single_controller&#39;</span>
<span class="n">plecs_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

<span class="c1"># --- Sim ---</span>
<span class="c1"># Plecs model</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">PlecsModel</span><span class="p">(</span>
    <span class="n">plecs_file</span><span class="p">,</span> <span class="n">plecs_file_path</span><span class="p">,</span>
    <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">(),</span>
    <span class="n">get_ctl_gains</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">controller_gains</span>
    <span class="p">)</span>

<span class="c1"># Runs simulation</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="n">ctl_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ts&#39;</span><span class="p">:</span> <span class="mf">2.5e-3</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>

<span class="c1"># --- Results ---</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Duty-cycle&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$u$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Output voltage&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Voltage (V)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (ms)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Note that <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel.sim" title="plecsutil.ui.PlecsModel.sim"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel.sim()</span></code></a> is called with <code class="docutils literal notranslate"><span class="pre">ctl_params</span></code> set to <code class="docutils literal notranslate"><span class="pre">{'ts':</span> <span class="pre">2.5e-3,</span> <span class="pre">'os':</span> <span class="pre">5}</span></code>. These parameters are used to generate the controller gains, which in turn are updated in the model parameters file.</p>
<p>Now, running the simulation with different controller parameters is just a matter of calling <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel.sim" title="plecsutil.ui.PlecsModel.sim"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel.sim()</span></code></a> with different control parameters. An example is demonstrated in the script below.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-number">Listing 7 </span><span class="caption-text">Running a simulation with different controller parameters (<a class="reference download internal" download="" href="_downloads/eeca70fdc526fd4845a3b7e4d151b770/buck_single_controller_var_params.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">source</span></code></a>)</span><a class="headerlink" href="#id7" title="Permalink to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">plecsutil</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pu</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">model</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

<span class="c1"># --- Input ---</span>
<span class="n">plecs_file</span> <span class="o">=</span> <span class="s1">&#39;buck_single_controller&#39;</span>
<span class="n">plecs_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

<span class="c1"># --- Sim ---</span>
<span class="c1"># Plecs model</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">PlecsModel</span><span class="p">(</span>
    <span class="n">plecs_file</span><span class="p">,</span> <span class="n">plecs_file_path</span><span class="p">,</span>
    <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">(),</span>
    <span class="n">get_ctl_gains</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">controller_gains</span>
    <span class="p">)</span>

<span class="c1"># Runs simulations</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ctl_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;ts&#39;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;ts&#39;</span><span class="p">:</span> <span class="mf">3e-3</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;ts&#39;</span><span class="p">:</span> <span class="mf">5e-3</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
    <span class="p">]</span>
<span class="k">for</span> <span class="n">cp</span> <span class="ow">in</span> <span class="n">ctl_params</span><span class="p">:</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="n">ctl_params</span><span class="o">=</span><span class="n">cp</span><span class="p">,</span> <span class="n">close_sim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

<span class="c1"># --- Results ---</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Duty-cycle&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;$T_s = </span><span class="si">{:}</span><span class="s1">$ ms&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">d</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;ctl_params&#39;</span><span class="p">][</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e-3</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$u$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Inductor current&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Current (A)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Output voltage&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Voltage (V)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (ms)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="multiple-controllers">
<h3>Multiple controllers<a class="headerlink" href="#multiple-controllers" title="Permalink to this heading"></a></h3>
<p>There are many cases where we would like to have multiple controllers in the model, so that we can easily compare them. This case is also supported in <code class="docutils literal notranslate"><span class="pre">plecsutil</span></code>, by following a couple of rules in the PLECS model, and by defining the controllers as an <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.Controller" title="plecsutil.ui.Controller"><code class="xref py py-class docutils literal notranslate"><span class="pre">plecsutil.ui.Controller</span></code></a> object.</p>
<p>First, let’s consider the Buck model we’ve been using so far, and let’s assume we want to compare two controllers: a state feedback and a cascaded controller. First, we define our controller as a configurable subsystem in PLECS, as shown in  <a class="reference internal" href="#fig-user-guide-controllers-multiple-controller"><span class="std std-numref">Fig. 4</span></a>.</p>
<figure class="align-center" id="fig-user-guide-controllers-multiple-controller">
<a class="reference internal image-reference" href="_images/controllers.svg"><img alt="Buck model with two controllers as configurable subsystem" height="402" src="_images/controllers.svg" width="382" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text">Buck model with controllers as a configurable subsystem (<a class="reference download internal" download="" href="_downloads/e96b753307498a4618defef473a310b6/buck_multiple_controllers.plecs"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">model</span></code></a>).</span><a class="headerlink" href="#fig-user-guide-controllers-multiple-controller" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Next, we open  the configurable subsystem (right-click on subsystem, Subsystem, Open subsystem) and create the controllers there. For this example, we’ve created two subsystems: <code class="docutils literal notranslate"><span class="pre">state_feedback</span></code> and <code class="docutils literal notranslate"><span class="pre">cascaded</span></code>, representing the controllers we want to compare. This is shown in <a class="reference internal" href="#fig-user-guide-controllers-multiple-controller-subsys"><span class="std std-numref">Fig. 5</span></a>.</p>
<figure class="align-center" id="fig-user-guide-controllers-multiple-controller-subsys">
<a class="reference internal image-reference" href="_images/controllers_subsys.png"><img alt="Controllers as a configurable subsystem" src="_images/controllers_subsys.png" style="width: 363.59999999999997px; height: 312.59999999999997px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Controllers in the configurable subsystem.</span><a class="headerlink" href="#fig-user-guide-controllers-multiple-controller-subsys" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Now, we go back to the <cite>Controller</cite> subsystem (<a class="reference internal" href="#fig-user-guide-controllers-multiple-controller"><span class="std std-numref">Fig. 4</span></a>), double click on the configurable subsystem containing the controllers, and in the <cite>Configuration</cite> option we select <code class="docutils literal notranslate"><span class="pre">&lt;reference&gt;</span></code> and type <code class="docutils literal notranslate"><span class="pre">CTL_SEL</span></code>, as shown in <a class="reference internal" href="#fig-user-guide-controllers-multiple-controller-subsys-cfg"><span class="std std-numref">Fig. 6</span></a>.</p>
<figure class="align-center" id="fig-user-guide-controllers-multiple-controller-subsys-cfg">
<a class="reference internal image-reference" href="_images/controllers_subsys_cfg.png"><img alt="Setting configuration as reference" src="_images/controllers_subsys_cfg.png" style="width: 216.0px; height: 124.19999999999999px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">Setting <cite>CTL_SEL</cite> as the configuration of the configurable subsystem.</span><a class="headerlink" href="#fig-user-guide-controllers-multiple-controller-subsys-cfg" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Now, we will build the <code class="docutils literal notranslate"><span class="pre">model.py</span></code> file much in the same way as before. We can create one function for the parameters of the plant, and one function for each controller. Then, a single function is created to concatenate all the parameters in a single model parameter dictionary. A script for this is shown below.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-number">Listing 8 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">model.py</span></code> file for multiple controllers (<a class="reference download internal" download="" href="_downloads/e3e7a246425a4f8290f52f7ec88e2092/model.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">source</span></code></a>)</span><a class="headerlink" href="#id8" title="Permalink to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.signal</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">plecsutil</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pu</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plant_params</span><span class="p">():</span>

    <span class="n">V_in</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">Vo_ref</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="n">L</span> <span class="o">=</span> <span class="mf">47e-6</span>
    <span class="n">C_out</span> <span class="o">=</span> <span class="mf">220e-6</span>

    <span class="n">f_pwm</span> <span class="o">=</span> <span class="mf">100e3</span>

    <span class="n">R</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">Rd</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="n">_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>
    <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;C_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">C_out</span>
    <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span>
    <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;Rd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rd</span>

    <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;V_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_in</span>
    <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;Vo_ref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Vo_ref</span>
    
    <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;f_pwm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">100e3</span>

    <span class="k">return</span> <span class="n">_params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">sfb_get_gains</span><span class="p">(</span><span class="n">ctl_params</span><span class="p">):</span>
    
    <span class="n">ts</span> <span class="o">=</span> <span class="n">ctl_params</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span>
    <span class="n">os</span> <span class="o">=</span> <span class="n">ctl_params</span><span class="p">[</span><span class="s1">&#39;os&#39;</span><span class="p">]</span>

    <span class="n">_plant_params</span> <span class="o">=</span> <span class="n">plant_params</span><span class="p">()</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">_plant_params</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">_plant_params</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">_plant_params</span><span class="p">[</span><span class="s1">&#39;C_out&#39;</span><span class="p">]</span>
    <span class="n">V_in</span> <span class="o">=</span> <span class="n">_plant_params</span><span class="p">[</span><span class="s1">&#39;V_in&#39;</span><span class="p">]</span>
    
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span>       <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">L</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="n">C</span><span class="p">,</span>   <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">R</span> <span class="o">/</span> <span class="n">C</span><span class="p">]</span>
        <span class="p">])</span>
    
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="n">V_in</span> <span class="o">/</span> <span class="n">L</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">])</span>

    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    
    <span class="n">Aa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">Aa</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span>
    <span class="n">Aa</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">C</span>

    <span class="n">Ba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">Ba</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">zeta</span><span class="p">,</span> <span class="n">wn</span> <span class="o">=</span> <span class="n">_zeta_wn</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">os</span><span class="p">)</span>

    <span class="n">p1</span> <span class="o">=</span> <span class="o">-</span> <span class="n">zeta</span> <span class="o">*</span> <span class="n">wn</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">wn</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zeta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
    <span class="n">p3</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">p1</span><span class="o">.</span><span class="n">real</span>
    
    <span class="n">K</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">place_poles</span><span class="p">(</span><span class="n">Aa</span><span class="p">,</span> <span class="n">Ba</span><span class="p">,</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">))</span><span class="o">.</span><span class="n">gain_matrix</span>

    <span class="n">Kx</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">Ke</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Kx&#39;</span><span class="p">:</span> <span class="n">Kx</span><span class="p">,</span> <span class="s1">&#39;Ke&#39;</span><span class="p">:</span> <span class="n">Ke</span><span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">cascaded_get_gains</span><span class="p">(</span><span class="n">ctl_params</span><span class="p">):</span>

    <span class="n">_plant_params</span> <span class="o">=</span> <span class="n">plant_params</span><span class="p">()</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">_plant_params</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">_plant_params</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">_plant_params</span><span class="p">[</span><span class="s1">&#39;C_out&#39;</span><span class="p">]</span>
    <span class="n">V_in</span> <span class="o">=</span> <span class="n">_plant_params</span><span class="p">[</span><span class="s1">&#39;V_in&#39;</span><span class="p">]</span>

    <span class="n">ts_v</span> <span class="o">=</span> <span class="n">ctl_params</span><span class="p">[</span><span class="s1">&#39;ts_v&#39;</span><span class="p">]</span>
    <span class="n">os_v</span> <span class="o">=</span> <span class="n">ctl_params</span><span class="p">[</span><span class="s1">&#39;os_v&#39;</span><span class="p">]</span>
    
    <span class="n">ts_i</span> <span class="o">=</span> <span class="n">ctl_params</span><span class="p">[</span><span class="s1">&#39;ts_i&#39;</span><span class="p">]</span>
    <span class="n">os_i</span> <span class="o">=</span> <span class="n">ctl_params</span><span class="p">[</span><span class="s1">&#39;os_i&#39;</span><span class="p">]</span>

    <span class="n">zeta_i</span><span class="p">,</span> <span class="n">wn_i</span> <span class="o">=</span> <span class="n">_zeta_wn</span><span class="p">(</span><span class="n">ts_i</span><span class="p">,</span> <span class="n">os_i</span><span class="p">)</span>
    <span class="n">ki</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span> <span class="o">/</span> <span class="n">V_in</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">zeta_i</span> <span class="o">*</span> <span class="n">wn_i</span>
    <span class="n">k_ei</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span> <span class="o">/</span> <span class="n">V_in</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="o">-</span> <span class="n">wn_i</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

    <span class="n">zeta_v</span><span class="p">,</span> <span class="n">wn_v</span> <span class="o">=</span> <span class="n">_zeta_wn</span><span class="p">(</span><span class="n">ts_v</span><span class="p">,</span> <span class="n">os_v</span><span class="p">)</span>
    <span class="n">kv</span> <span class="o">=</span> <span class="p">(</span> <span class="n">C</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">zeta_v</span> <span class="o">*</span> <span class="n">wn_v</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">R</span> <span class="o">/</span> <span class="n">C</span> <span class="p">)</span>
    <span class="n">k_ev</span> <span class="o">=</span> <span class="p">(</span> <span class="n">C</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="o">-</span> <span class="n">wn_v</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ki&#39;</span><span class="p">:</span> <span class="n">ki</span><span class="p">,</span> <span class="s1">&#39;k_ei&#39;</span><span class="p">:</span> <span class="n">k_ei</span><span class="p">,</span> <span class="s1">&#39;kv&#39;</span><span class="p">:</span> <span class="n">kv</span><span class="p">,</span> <span class="s1">&#39;k_ev&#39;</span><span class="p">:</span><span class="n">k_ev</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">params</span><span class="p">():</span>

    <span class="c1"># Plant parameters</span>
    <span class="n">_plant_params</span> <span class="o">=</span> <span class="n">plant_params</span><span class="p">()</span>

    <span class="c1"># Control parameters</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="mf">2e-3</span>
    <span class="n">os</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="n">_sfb_params</span> <span class="o">=</span> <span class="n">sfb_get_gains</span><span class="p">({</span><span class="s1">&#39;ts&#39;</span><span class="p">:</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">:</span><span class="n">os</span><span class="p">})</span>
    <span class="n">_casc_params</span> <span class="o">=</span> <span class="n">cascaded_get_gains</span><span class="p">(</span>
        <span class="p">{</span><span class="s1">&#39;ts_v&#39;</span><span class="p">:</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;os_v&#39;</span><span class="p">:</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;ts_i&#39;</span><span class="p">:</span><span class="n">ts</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;os_i&#39;</span><span class="p">:</span><span class="n">os</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="n">_ctl_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_ctl_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">_sfb_params</span><span class="p">)</span>
    <span class="n">_ctl_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">_casc_params</span><span class="p">)</span>

    <span class="c1"># List of controllers</span>
    <span class="n">n_ctl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">CONTROLLERS</span><span class="p">)</span>
    <span class="n">active_ctl</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">l_ctl</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">gen_controllers_params</span><span class="p">(</span><span class="n">n_ctl</span><span class="p">,</span> <span class="n">active_ctl</span><span class="p">)</span>

    <span class="c1"># Params for plecs</span>
    <span class="n">_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">_plant_params</span> <span class="p">)</span>
    <span class="n">_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">_ctl_params</span> <span class="p">)</span>
    <span class="n">_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">l_ctl</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">_params</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_zeta_wn</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">os</span><span class="p">):</span>

    <span class="n">zeta</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">os</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">os</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    <span class="n">wn</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">ts</span> <span class="o">/</span> <span class="n">zeta</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">zeta</span><span class="p">,</span> <span class="n">wn</span><span class="p">)</span>


<span class="n">CONTROLLERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;sfb&#39;</span> <span class="p">:</span> <span class="n">pu</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Controller</span><span class="p">(</span><span class="n">idx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">get_gains</span><span class="o">=</span><span class="n">sfb_get_gains</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;State feedback&#39;</span><span class="p">),</span>
    <span class="s1">&#39;casc&#39;</span><span class="p">:</span> <span class="n">pu</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Controller</span><span class="p">(</span><span class="n">idx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">get_gains</span><span class="o">=</span><span class="n">cascaded_get_gains</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cascaded&#39;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>In the script above, there  are two main differences compared to the single controller case. The first one is that the <code class="docutils literal notranslate"><span class="pre">params</span></code> function includes a call to <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.gen_controllers_params" title="plecsutil.ui.gen_controllers_params"><code class="xref py py-func docutils literal notranslate"><span class="pre">plecsutil.ui.gen_controllers_params()</span></code></a>. This function generates the variable <code class="docutils literal notranslate"><span class="pre">CTL_SEL</span></code> seen in  <a class="reference internal" href="#fig-user-guide-controllers-multiple-controller-subsys-cfg"><span class="std std-numref">Fig. 6</span></a>, which is used to select the controller. The second difference is that at the end of the script, a <code class="docutils literal notranslate"><span class="pre">CONTROLLERS</span></code> dictionary is defined, containing the two controllers of the model. Each entry of this dictionary contains a label for the controller, and a <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.Controller" title="plecsutil.ui.Controller"><code class="xref py py-class docutils literal notranslate"><span class="pre">plecsutil.ui.Controller</span></code></a> object initialized with an <code class="docutils literal notranslate"><span class="pre">idx</span></code>, a <code class="docutils literal notranslate"><span class="pre">get_gains</span></code> callback, and a <code class="docutils literal notranslate"><span class="pre">label</span></code> parameter. The value of <code class="docutils literal notranslate"><span class="pre">idx</span></code> must match the pattern used in the subsystem of the model. In PLECS, subsystems within a configurable subsystem are assigned indices starting at 1 and incrementing from left to right, i.e. <code class="docutils literal notranslate"><span class="pre">state_feedback</span></code> is index 1, and <code class="docutils literal notranslate"><span class="pre">cascaded</span></code> is index 2 (see <a class="reference internal" href="#fig-user-guide-controllers-multiple-controller-subsys"><span class="std std-numref">Fig. 5</span></a>).</p>
<p>Now, we can finally build the script to run the simulations with different controllers, with an example given below. The <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel" title="plecsutil.ui.PlecsModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel</span></code></a> is created as before, but now we give the controllers of the model with <code class="docutils literal notranslate"><span class="pre">controllers=model.CONTROLLERS</span></code>. Then, when running the simulation, we give <code class="docutils literal notranslate"><span class="pre">ctl_params</span></code> just like we do for the single controller models, but we additionally give <code class="docutils literal notranslate"><span class="pre">ctl</span></code>, which must be one of the controllers defined in <code class="docutils literal notranslate"><span class="pre">model.CONTROLLERS</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">ctl_params</span></code> changes for each controller (although they could also be the same).</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-number">Listing 9 </span><span class="caption-text">Running models with multiple controllers (<a class="reference download internal" download="" href="_downloads/3ab96dca2230379db1120b9a3ed5f5a9/buck_multiple_controllers.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">source</span></code></a>)</span><a class="headerlink" href="#id9" title="Permalink to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plecsutil</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pu</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">model</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

<span class="c1"># --- Input ---</span>
<span class="n">plecs_file</span> <span class="o">=</span> <span class="s1">&#39;buck_multiple_controllers&#39;</span>
<span class="n">plecs_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

<span class="c1"># --- Sim ---</span>
<span class="c1"># Plecs model</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">PlecsModel</span><span class="p">(</span>
    <span class="n">plecs_file</span><span class="p">,</span> <span class="n">plecs_file_path</span><span class="p">,</span>
    <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">(),</span>
    <span class="n">controllers</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">CONTROLLERS</span>
    <span class="p">)</span>

<span class="c1"># Runs simulations</span>
<span class="n">d1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="n">ctl</span><span class="o">=</span><span class="s1">&#39;sfb&#39;</span><span class="p">,</span> <span class="n">ctl_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ts&#39;</span><span class="p">:</span><span class="mf">1.5e-3</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">},</span> <span class="n">save</span><span class="o">=</span><span class="s1">&#39;tst&#39;</span><span class="p">)</span>
<span class="n">d2</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="n">ctl</span><span class="o">=</span><span class="s1">&#39;casc&#39;</span><span class="p">,</span> <span class="n">ctl_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ts_v&#39;</span><span class="p">:</span><span class="mf">1.5e-3</span><span class="p">,</span> <span class="s1">&#39;os_v&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;ts_i&#39;</span><span class="p">:</span><span class="mf">0.15e-3</span><span class="p">,</span> <span class="s1">&#39;os_i&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">})</span>
<span class="n">data</span>  <span class="o">=</span> <span class="p">[</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">]</span>

<span class="c1"># --- Results ---</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Duty-cycle&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">d</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;ctl_label&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$u$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Output voltage&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Voltage (V)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (ms)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="saving-and-loading-simulation-results">
<span id="sec-user-guide-save-load"></span><h2>Saving and loading simulation results<a class="headerlink" href="#saving-and-loading-simulation-results" title="Permalink to this heading"></a></h2>
<p>With <code class="docutils literal notranslate"><span class="pre">plecsutil</span></code>, it is possible to save and load simulations results. When calling <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel.sim" title="plecsutil.ui.PlecsModel.sim"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel.sim()</span></code></a> to run a simulation, it is possible to automatically save the results after a simulation finishes by setting <code class="docutils literal notranslate"><span class="pre">save</span></code> to a nonempty string. For example, running</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pm</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="n">ctl</span><span class="o">=</span><span class="s1">&#39;sfb&#39;</span><span class="p">,</span> <span class="n">ctl_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ts&#39;</span><span class="p">:</span><span class="mf">1.5e-3</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">},</span> <span class="n">save</span><span class="o">=</span><span class="s1">&#39;sfb_sim_results&#39;</span><span class="p">,</span> <span class="n">ret_data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>will save the simulation results in a file called <code class="docutils literal notranslate"><span class="pre">sfb_sim_results.zip</span></code>. The data is saved as a <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.DataSet" title="plecsutil.ui.DataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">plecsutil.ui.DataSet</span></code></a> object, which includes simulation and meta data, such as model and controller parameters.</p>
<p>Data is loaded with <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.load_data" title="plecsutil.ui.load_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">plecsutil.ui.load_data()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="s1">&#39;sfb_sim_results&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">data</span></code> is a <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.DataSet" title="plecsutil.ui.DataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">plecsutil.ui.DataSet</span></code></a> object, and can be handled exactly in the same way as simulation results returned by <a class="reference internal" href="plecsutil.ui.html#plecsutil.ui.PlecsModel.sim" title="plecsutil.ui.PlecsModel.sim"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plecsutil.ui.PlecsModel.sim()</span></code></a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">plecsutil</span></code> uses <a class="reference external" href="https://docs.python.org/3/library/pickle.html">pickle</a> under the hood for serializing and de-serializing the simulation results. This is simple and efficient, but is not safe for file sharing. Only load simulation data that you generated yourself, or that you trust the source.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quickstart_guide.html" class="btn btn-neutral float-left" title="Quickstart guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="plecsutil.html" class="btn btn-neutral float-right" title="plecsutil package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, plecsutil developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>